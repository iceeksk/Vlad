var input = '[{"category":"T-shirts","img":"images/t-shirts.png","goods":[{"name":"t-shirts-0","img":"images/t-shirts-0.png","price":15},{"name":"t-shirts-1","img":"images/t-shirts-1.png","price":18},{"name":"t-shirts-2","img":"images/t-shirts-2.png","price":17},{"name":"t-shirts-3","img":"images/t-shirts-3.png","price":18},{"name":"t-shirts-4","img":"images/t-shirts-4.png","price":16}]},{"category":"Caps","img":"images/caps.png","goods":[{"name":"caps-0","img":"images/caps-0.png","price":6},{"name":"caps-1","img":"images/caps-1.png","price":4},{"name":"caps-2","img":"images/caps-2.png","price":8},{"name":"caps-3","img":"images/caps-3.png","price":6},{"name":"caps-4","img":"images/caps-4.png","price":10}]},{"category":"Cards","img":"images/cards.png","goods":[{"name":"cards-0","img":"images/cards-0.png","price":6},{"name":"cards-1","img":"images/cards-1.png","price":4},{"name":"cards-2","img":"images/cards-2.png","price":8},{"name":"cards-3","img":"images/cards-3.png","price":6},{"name":"cards-4","img":"images/cards-4.png","price":10}]},{"category":"Toys","img":"images/toys.png","goods":[{"name":"toys-0","img":"images/toys-0.png","price":16},{"name":"toys-1","img":"images/toys-1.png","price":14},{"name":"toys-2","img":"images/toys-2.png","price":18},{"name":"toys-3","img":"images/toys-3.png","price":16},{"name":"toys-4","img":"images/toys-4.png","price":10}]},{"category":"Magnets","img":"images/magnets.png","goods":[{"name":"magnets-0","img":"images/magnets-0.png","price":1},{"name":"magnets-1","img":"images/magnets-1.png","price":2},{"name":"magnets-2","img":"images/magnets-2.png","price":4},{"name":"magnets-3","img":"images/magnets-3.png","price":1},{"name":"magnets-4","img":"images/magnets-4.png","price":1}]},{"category":"Pens & Pencils","img":"images/pens-pencils.png","goods":[{"name":"pens-pencils-0","img":"images/pens-pencils-0.png","price":5},{"name":"pens-pencils-1","img":"images/pens-pencils-1.png","price":2},{"name":"pens-pencils-2","img":"images/pens-pencils-2.png","price":4},{"name":"pens-pencils-3","img":"images/pens-pencils-3.png","price":3},{"name":"pens-pencils-4","img":"images/pens-pencils-4.png","price":8}]},{"category":"Bags","img":"images/bags.png","goods":[{"name":"bags-0","img":"images/bags-0.png","price":15},{"name":"bags-1","img":"images/bags-1.png","price":12},{"name":"bags-2","img":"images/bags-2.png","price":14},{"name":"bags-3","img":"images/bags-3.png","price":13},{"name":"bags-4","img":"images/bags-4.png","price":18}]},{"category":"Notebooks","img":"images/notebooks.png","goods":[{"name":"notebooks-0","img":"images/notebooks-0.png","price":315},{"name":"notebooks-1","img":"images/notebooks-1.png","price":482},{"name":"notebooks-2","img":"images/notebooks-2.png","price":514},{"name":"notebooks-3","img":"images/notebooks-3.png","price":343},{"name":"notebooks-4","img":"images/notebooks-4.png","price":180}]},{"category":"Scrum cards","img":"images/scrum.png","goods":[{"name":"scrum-0","img":"images/scrum-0.png","price":5},{"name":"scrum-1","img":"images/scrum-1.png","price":2},{"name":"scrum-2","img":"images/scrum-2.png","price":4},{"name":"scrum-3","img":"images/scrum-3.png","price":3},{"name":"scrum-4","img":"images/scrum-4.png","price":1}]},{"category":"T-shirts","img":"images/t-shirts.png","goods":[{"name":"t-shirts-0","img":"images/t-shirts-0.png","price":15},{"name":"t-shirts-1","img":"images/t-shirts-1.png","price":18},{"name":"t-shirts-2","img":"images/t-shirts-2.png","price":17},{"name":"t-shirts-3","img":"images/t-shirts-3.png","price":18},{"name":"t-shirts-4","img":"images/t-shirts-4.png","price":16}]},{"category":"Caps","img":"images/caps.png","goods":[{"name":"caps-0","img":"images/caps-0.png","price":6},{"name":"caps-1","img":"images/caps-1.png","price":4},{"name":"caps-2","img":"images/caps-2.png","price":8},{"name":"caps-3","img":"images/caps-3.png","price":6},{"name":"caps-4","img":"images/caps-4.png","price":10}]},{"category":"Cards","img":"images/cards.png","goods":[{"name":"cards-0","img":"images/cards-0.png","price":6},{"name":"cards-1","img":"images/cards-1.png","price":4},{"name":"cards-2","img":"images/cards-2.png","price":8},{"name":"cards-3","img":"images/cards-3.png","price":6},{"name":"cards-4","img":"images/cards-4.png","price":10}]},{"category":"Toys","img":"images/toys.png","goods":[{"name":"toys-0","img":"images/toys-0.png","price":16},{"name":"toys-1","img":"images/toys-1.png","price":14},{"name":"toys-2","img":"images/toys-2.png","price":18},{"name":"toys-3","img":"images/toys-3.png","price":16},{"name":"toys-4","img":"images/toys-4.png","price":10}]},{"category":"Magnets","img":"images/magnets.png","goods":[{"name":"magnets-0","img":"images/magnets-0.png","price":1},{"name":"magnets-1","img":"images/magnets-1.png","price":2},{"name":"magnets-2","img":"images/magnets-2.png","price":4},{"name":"magnets-3","img":"images/magnets-3.png","price":1},{"name":"magnets-4","img":"images/magnets-4.png","price":1}]},{"category":"Pens & Pencils","img":"images/pens-pencils.png","goods":[{"name":"pens-pencils-0","img":"images/pens-pencils-0.png","price":5},{"name":"pens-pencils-1","img":"images/pens-pencils-1.png","price":2},{"name":"pens-pencils-2","img":"images/pens-pencils-2.png","price":4},{"name":"pens-pencils-3","img":"images/pens-pencils-3.png","price":3},{"name":"pens-pencils-4","img":"images/pens-pencils-4.png","price":8}]},{"category":"Bags","img":"images/bags.png","goods":[{"name":"bags-0","img":"images/bags-0.png","price":15},{"name":"bags-1","img":"images/bags-1.png","price":12},{"name":"bags-2","img":"images/bags-2.png","price":14},{"name":"bags-3","img":"images/bags-3.png","price":13},{"name":"bags-4","img":"images/bags-4.png","price":18}]},{"category":"Notebooks","img":"images/notebooks.png","goods":[{"name":"notebooks-0","img":"images/notebooks-0.png","price":315},{"name":"notebooks-1","img":"images/notebooks-1.png","price":482},{"name":"notebooks-2","img":"images/notebooks-2.png","price":514},{"name":"notebooks-3","img":"images/notebooks-3.png","price":343},{"name":"notebooks-4","img":"images/notebooks-4.png","price":180}]},{"category":"Scrum cards","img":"images/scrum.png","goods":[{"name":"scrum-0","img":"images/scrum-0.png","price":5},{"name":"scrum-1","img":"images/scrum-1.png","price":2},{"name":"scrum-2","img":"images/scrum-2.png","price":4},{"name":"scrum-3","img":"images/scrum-3.png","price":3},{"name":"scrum-4","img":"images/scrum-4.png","price":1}]}]';
var inputData = JSON.parse(input);

$(document).ready(function () {
    var viewModel = new ViewModel();
    viewModel.activate(inputData);
    ko.applyBindings(viewModel);
});

function ViewModel() {
    var that = this;
    that.firstPageVisibility = ko.observable(true);
    that.activePage = ko.observable();
    that.categories = ko.observableArray([]);
    that.goodList = ko.observableArray([]);
    that.basketValue = ko.computed(function () {
        var value = 0;
        _.each(that.categories(), function (category) {
            _.each(category.goods, function (good) {
                value += good.amount() * good.price;
            })

        });
        return "$" + value
    });

    that.goToCategoryPage = function () {
        that.firstPageVisibility(false);
        that.activePage(this.category);
        that.goodList(_.find(that.categories(), function (category) {
            return category.category === that.activePage()
        }).goods);

    };

    that.backToIndex = function () {
        that.firstPageVisibility(true);
    };

    that.activate = function (data) {
        _.each(data, function (itemGroup) {
            _.each(itemGroup.goods, function (item) {
                item.amount = ko.observable(0);
                item.plus = function () {
                    item.amount(item.amount() + 1)
                };
                item.minus = function () {
                    if (item.amount() == 0) {
                        return
                    }
                    else {
                        item.amount(item.amount() - 1)
                    }
                }
            })
        });
        that.categories(data);
    }
}
